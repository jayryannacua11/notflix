const global={currentPage:window.location.pathname,search:{term:"",type:"",page:1,totalPages:1,totalResults:0},api:{apiKey:"fa655dac15a0e0ac78a594ef5d945bcc",apiUrl:"https://api.themoviedb.org/3/"}},displayPopularMovies=async()=>{const{results:results}=await fetchAPIData("movie/popular");results.forEach(movie=>{const movieEl=document.createElement("div"),formattedDate=formatDate(movie.release_date);movieEl.classList.add("card"),movieEl.innerHTML=`        \n          <a href="movie-details.html?id=${movie.id}">\n            ${movie.poster_path?`<img\n                src="https://image.tmdb.org/t/p/w500${movie.poster_path}"\n                class="card-img-top"\n                alt="${movie.title}"\n                />`:`<img\n                src="../images/no-image.jpg"\n                class="card-img-top"\n                alt="${movie.title}"\n                />`}\n          </a>\n          <div class="card-body">\n            <h5 class="card-title">${movie.title}</h5>\n            <p class="card-text">\n              <small class="text-muted">Release: ${formattedDate}</small>\n            </p>\n          </div>\n        `,document.querySelector("#popular-movies").appendChild(movieEl)})},displayPopularShows=async()=>{const{results:results}=await fetchAPIData("tv/popular");results.forEach(show=>{const showEl=document.createElement("div"),formattedDate=formatDate(show.first_air_date);showEl.classList.add("card"),showEl.innerHTML=`        \n          <a href="tv-details.html?id=${show.id}">\n            ${show.poster_path?`<img\n                src="https://image.tmdb.org/t/p/w500${show.poster_path}"\n                class="card-img-top"\n                alt="${show.name}"\n                />`:`<img\n                src="../images/no-image.jpg"\n                class="card-img-top"\n                alt="${show.name}"\n                />`}\n          </a>\n          <div class="card-body">\n            <h5 class="card-title">${show.name}</h5>\n            <p class="card-text">\n              <small class="text-muted">Release: ${formattedDate}</small>\n            </p>\n          </div>\n        `,document.querySelector("#popular-shows").appendChild(showEl)})},displayMovieDetails=async()=>{const movieID=window.location.search.split("=")[1],movie=await fetchAPIData(`movie/${movieID}`),formattedDate=formatDate(movie.release_date);displayImageOverlay("movie",movie.backdrop_path);const div=document.createElement("div");div.innerHTML=`\n            <div class="details-top">\n            <div>\n                ${movie.poster_path?`<img\n                    src="https://image.tmdb.org/t/p/w500${movie.poster_path}"\n                    class="card-img-top"\n                    alt="${movie.title}"\n                    />`:`<img\n                    src="../images/no-image.jpg"\n                    class="card-img-top"\n                    alt="${movie.title}"\n                    />`}\n            </div>\n          <div>\n            <h2>${movie.title}</h2>\n            <p>\n              <i class="fas fa-star text-primary"></i>\n              ${movie.vote_average.toFixed(1)} / 10\n            </p>\n            <p class="text-muted">Release Date: ${formattedDate}</p>\n            <p>\n              ${movie.overview}\n            </p>\n            <h5>Genres</h5>\n            <ul class="list-group">\n              ${movie.genres.map(genre=>`<li>${genre.name}</li>`).join("")}\n            </ul>\n            <a href="${movie.homepage}" target="_blank" class="btn">Visit Movie Homepage</a>\n          </div>\n        </div>\n        <div class="details-bottom">\n          <h2>Movie Info</h2>\n          <ul>\n            <li><span class="text-secondary">Budget:</span> ${0!==movie.budget?`$${formatMoney(movie.budget)}`:"N/A"}</li>\n            <li><span class="text-secondary">Revenue:</span> ${0!==movie.revenue?`$${formatMoney(movie.revenue)}`:"N/A"}</li>\n            <li><span class="text-secondary">Runtime:</span> ${movie.runtime} minutes</li>\n            <li><span class="text-secondary">Status:</span> ${movie.status}</li>\n          </ul>\n          <h4>Production Companies</h4>\n          <div class="list-group">${movie.production_companies.map(company=>`<span>${company.name}</span>`).join(", ")}</div>\n        </div>`,document.querySelector("#movie-details").appendChild(div)},displayShowDetails=async()=>{const showID=window.location.search.split("=")[1],show=await fetchAPIData(`tv/${showID}`),formattedDate=formatDate(show.last_air_date);displayImageOverlay("tv",show.backdrop_path);const div=document.createElement("div");div.innerHTML=`\n            <div class="details-top">\n            <div>\n                ${show.poster_path?`<img\n                    src="https://image.tmdb.org/t/p/w500${show.poster_path}"\n                    class="card-img-top"\n                    alt="${show.name}"\n                    />`:`<img\n                    src="../images/no-image.jpg"\n                    class="card-img-top"\n                    alt="${show.name}"\n                    />`}\n            </div>\n          <div>\n            <h2>${show.name}</h2>\n            <p>\n              <i class="fas fa-star text-primary"></i>\n              ${show.vote_average.toFixed(1)} / 10\n            </p>\n            <p class="text-muted">Last Air Date: ${formattedDate}</p>\n            <p>\n              ${show.overview}\n            </p>\n            <h5>Genres</h5>\n            <ul class="list-group">\n              ${show.genres.map(genre=>`<li>${genre.name}</li>`).join("")}\n            </ul>\n            <a href="${show.homepage}" target="_blank" class="btn">Visit show Homepage</a>\n          </div>\n        </div>\n        <div class="details-bottom">\n          <h2>Show Info</h2>\n          <ul>\n            <li><span class="text-secondary">Number of Episodes: </span> ${show.number_of_episodes}</li>\n            <li><span class="text-secondary">Last Episode to Air: </span> Season ${show.last_episode_to_air.season_number} - ${show.last_episode_to_air.name}</li>\n            <li><span class="text-secondary">Status:</span> ${show.status}</li>\n          </ul>\n          <h4>Production Companies</h4>\n          <div class="list-group">${show.production_companies.map(company=>`<span>${company.name}</span>`).join(", ")}</div>\n        </div>`,document.querySelector("#show-details").appendChild(div)},search=async()=>{const queryString=window.location.search,urlParams=new URLSearchParams(queryString);let inputSearch=document.querySelector("#search-term");global.search.type=urlParams.get("type"),global.search.term=urlParams.get("search-term"),global.search.term||showAlert("Please enter a valid input","alert-error");const{results:results,total_pages:total_pages,page:page,total_results:total_results}=await searchAPIData();global.search.page=page,global.search.totalPages=total_pages,global.search.totalResults=total_results,0!==results.length?(displaySearchResult(results),inputSearch.value=""):showAlert("No reults found")},displaySearchResult=results=>{document.querySelector("#search-results").innerHTML="",document.querySelector("#search-results-heading").innerHTML="",document.querySelector("#pagination").innerHTML="",results.forEach(result=>{const div=document.createElement("div");div.classList.add("card"),div.innerHTML=`        \n      <a href="${global.search.type}-details.html?id=${result.id}">\n        ${result.poster_path?`<img\n            src="https://image.tmdb.org/t/p/w500/${result.poster_path}"\n            class="card-img-top"\n            alt="${"movie"===global.search.type?result.title:result.name}"\n            />`:`<img\n            src="../images/no-image.jpg"\n            class="card-img-top"\n            alt="${"movie"===global.search.type?result.title:result.name}"\n            />`}\n      </a>\n      <div class="card-body">\n        <h5 class="card-title">${"movie"===global.search.type?result.title:result.name}</h5>\n        <p class="card-text">\n          <small class="text-muted">Release: ${"movie"===global.search.type?formatDate(result.release_date):formatDate(result.first_air_date)}</small>\n        </p>\n      </div>\n    `,document.querySelector("#search-results-heading").innerHTML=`<h2>${results.length} of ${global.search.totalResults} results for "${global.search.term}"</h2>`,document.querySelector("#search-results").appendChild(div)}),displayPagination()},displayPagination=()=>{const div=document.createElement("div");div.classList.add("pagination"),div.innerHTML=`\n  <button class="btn btn-primary" id="prev">Prev</button>\n  <button class="btn btn-primary" id="next">Next</button>\n  <div class="page-counter">Page ${global.search.page} of ${global.search.totalPages}</div>\n  `,document.querySelector("#pagination").appendChild(div);let prevBtn=document.querySelector("#prev"),nextBtn=document.querySelector("#next");1===global.search.page&&(prevBtn.disabled=!0),global.search.page===global.search.totalPages&&(nextBtn.disabled=!0),nextBtn.addEventListener("click",async()=>{global.search.page++,await new Promise(resolve=>setTimeout(resolve,500));const{results:results,total_pages:total_pages}=await searchAPIData();displaySearchResult(results),scrollToTop()}),prevBtn.addEventListener("click",async()=>{global.search.page--,await new Promise(resolve=>setTimeout(resolve,500));const{results:results,total_pages:total_pages}=await searchAPIData();displaySearchResult(results),scrollToTop()})},scrollToTop=()=>{const searchInput=document.querySelector("#search-term");searchInput&&searchInput.scrollIntoView({behavior:"smooth",block:"start"})},showAlert=(message,className)=>{const alertEl=document.createElement("div");alertEl.classList.add("alert",className),alertEl.appendChild(document.createTextNode(message)),document.querySelector("#alert").appendChild(alertEl),setTimeout(()=>alertEl.remove(),3e3)},displaySlider=async()=>{const{results:results}=await fetchAPIData("movie/now_playing");results.forEach(movie=>{const div=document.createElement("div");div.classList.add("swiper-slide"),div.innerHTML=`\n      <a href="movie-details.html?id=${movie.id}">\n        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}" />\n      </a>\n      <h4 class="swiper-rating">\n        <i class="fas fa-star text-secondary"></i> ${movie.vote_average.toFixed(1)} / 10\n      </h4>\n    `,document.querySelector(".swiper-wrapper").appendChild(div),initSwiper()})},initSwiper=()=>{const swiper=new Swiper(".swiper",{slidesPerView:1,spaceBetween:30,freeMode:!1,loop:!0,autoplay:{delay:4e3,disableOnInteraction:!1},breakpoints:{500:{slidesPerView:2},700:{slidesPerView:3},1200:{slidesPerView:4}}})},displayImageOverlay=(type,bgpath)=>{const overlayDiv=document.createElement("div");overlayDiv.classList.add("bg-overlay"),overlayDiv.style.backgroundImage=`url(https://images.tmdb.org/t/p/original/${bgpath})`,"movie"===type&&document.querySelector("#movie-details").appendChild(overlayDiv),"tv"===type&&document.querySelector("#show-details").appendChild(overlayDiv)},formatDate=date=>new Date(date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),formatMoney=money=>money.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");async function fetchAPIData(endpoint){const API_KEY=global.api.apiKey,API_URL=global.api.apiUrl;showSpinner();const response=await fetch(`${API_URL}${endpoint}?api_key=${API_KEY}&language=en-US`);return hideSpinner(),data=await response.json()}async function searchAPIData(){const API_KEY=global.api.apiKey,API_URL=global.api.apiUrl;showSpinner();const response=await fetch(`${API_URL}search/${global.search.type}?api_key=${API_KEY}&language=en-US&query=${global.search.term}&page=${global.search.page}`),data=await response.json();return hideSpinner(),data}const showSpinner=()=>{document.querySelector(".spinner").classList.add("show")},hideSpinner=()=>{document.querySelector(".spinner").classList.remove("show")},activeNav=()=>{const links=document.querySelectorAll(".nav-link");links.forEach(link=>{link.getAttribute("href")===global.currentPage&&link.classList.add("active")})};function init(){switch(global.currentPage){case"/":case"/index.html":displaySlider(),displayPopularMovies();break;case"/shows":case"/shows.html":displayPopularShows();break;case"/movie-details":case"/movie-details.html":displayMovieDetails();break;case"/tv-details":case"/tv-details.html":displayShowDetails();break;case"/search":case"/search.html":search()}activeNav()}document.addEventListener("DOMContentLoaded",init);